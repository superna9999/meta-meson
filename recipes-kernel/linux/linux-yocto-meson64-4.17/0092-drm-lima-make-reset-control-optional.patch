From 21e6c12523245744270f45aec88b2ab4764c251b Mon Sep 17 00:00:00 2001
From: Simon Shields <simon@lineageos.org>
Date: Sat, 13 Jan 2018 13:37:44 +1100
Subject: [PATCH 092/134] drm: lima: make reset control optional

Exynos SoCs don't have a reset line for the GPU.

Signed-off-by: Simon Shields <simon@lineageos.org>
---
 drivers/gpu/drm/lima/lima_device.c | 11 ++++++-----
 1 file changed, 6 insertions(+), 5 deletions(-)

diff --git a/drivers/gpu/drm/lima/lima_device.c b/drivers/gpu/drm/lima/lima_device.c
index 797fb8d..00ea83d 100644
--- a/drivers/gpu/drm/lima/lima_device.c
+++ b/drivers/gpu/drm/lima/lima_device.c
@@ -52,15 +52,15 @@ static int lima_clk_init(struct lima_device *dev)
 	if ((err = clk_prepare_enable(dev->clk_gpu)))
 		goto error_out0;
 
-	dev->reset = devm_reset_control_get(dev->dev, NULL);
+	dev->reset = devm_reset_control_get_optional(dev->dev, NULL);
 	if (IS_ERR(dev->reset)) {
 		err = PTR_ERR(dev->reset);
 		goto error_out1;
+	} else if (dev->reset != NULL) {
+		if ((err = reset_control_deassert(dev->reset)))
+			goto error_out1;
 	}
 
-	if ((err = reset_control_deassert(dev->reset)))
-		goto error_out1;
-
 	return 0;
 
 error_out1:
@@ -72,7 +72,8 @@ static int lima_clk_init(struct lima_device *dev)
 
 static void lima_clk_fini(struct lima_device *dev)
 {
-	reset_control_assert(dev->reset);
+	if (dev->reset != NULL)
+		reset_control_assert(dev->reset);
 	clk_disable_unprepare(dev->clk_gpu);
 	clk_disable_unprepare(dev->clk_bus);
 }
-- 
2.0.1

