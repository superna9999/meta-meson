From 5f866c2da5c29684a2c2ee79dd2c36a942ca8daf Mon Sep 17 00:00:00 2001
From: Qiang Yu <yuq825@gmail.com>
Date: Sat, 25 Mar 2017 15:16:39 +0800
Subject: [PATCH] drm/lima: init commit for adding lima driver

Signed-off-by: Qiang Yu <yuq825@gmail.com>
---
 drivers/gpu/drm/Kconfig         |  2 ++
 drivers/gpu/drm/Makefile        |  1 +
 drivers/gpu/drm/lima/Kconfig    |  7 ++++++
 drivers/gpu/drm/lima/Makefile   |  4 ++++
 drivers/gpu/drm/lima/lima_drv.c | 47 +++++++++++++++++++++++++++++++++++++++++
 5 files changed, 61 insertions(+)
 create mode 100644 drivers/gpu/drm/lima/Kconfig
 create mode 100644 drivers/gpu/drm/lima/Makefile
 create mode 100644 drivers/gpu/drm/lima/lima_drv.c

diff --git a/drivers/gpu/drm/Kconfig b/drivers/gpu/drm/Kconfig
index deeefa7..f00d529 100644
--- a/drivers/gpu/drm/Kconfig
+++ b/drivers/gpu/drm/Kconfig
@@ -289,6 +289,8 @@ source "drivers/gpu/drm/pl111/Kconfig"
 
 source "drivers/gpu/drm/tve200/Kconfig"
 
+source "drivers/gpu/drm/lima/Kconfig"
+
 # Keep legacy drivers last
 
 menuconfig DRM_LEGACY
diff --git a/drivers/gpu/drm/Makefile b/drivers/gpu/drm/Makefile
index 50093ff..aba686e 100644
--- a/drivers/gpu/drm/Makefile
+++ b/drivers/gpu/drm/Makefile
@@ -103,3 +103,4 @@ obj-$(CONFIG_DRM_MXSFB)	+= mxsfb/
 obj-$(CONFIG_DRM_TINYDRM) += tinydrm/
 obj-$(CONFIG_DRM_PL111) += pl111/
 obj-$(CONFIG_DRM_TVE200) += tve200/
+obj-$(CONFIG_DRM_LIMA)  += lima/
diff --git a/drivers/gpu/drm/lima/Kconfig b/drivers/gpu/drm/lima/Kconfig
new file mode 100644
index 0000000..1f746b5
--- /dev/null
+++ b/drivers/gpu/drm/lima/Kconfig
@@ -0,0 +1,7 @@
+
+config DRM_LIMA
+       tristate "LIMA (DRM support for ARM Mali 400 GPU)"
+       depends on DRM
+       depends on ARCH_SUNXI
+       help
+         DRM driver for ARM Mali 400 GPUs.
diff --git a/drivers/gpu/drm/lima/Makefile b/drivers/gpu/drm/lima/Makefile
new file mode 100644
index 0000000..a1ab2ea
--- /dev/null
+++ b/drivers/gpu/drm/lima/Makefile
@@ -0,0 +1,4 @@
+lima-y := \
+	lima_drv.o
+
+obj-$(CONFIG_DRM_LIMA) += lima.o
diff --git a/drivers/gpu/drm/lima/lima_drv.c b/drivers/gpu/drm/lima/lima_drv.c
new file mode 100644
index 0000000..df13108
--- /dev/null
+++ b/drivers/gpu/drm/lima/lima_drv.c
@@ -0,0 +1,47 @@
+#include <linux/module.h>
+#include <linux/of_platform.h>
+
+static int lima_pdev_probe(struct platform_device *pdev)
+{
+	return 0;
+}
+
+static int lima_pdev_remove(struct platform_device *pdev)
+{
+	return 0;
+}
+
+static const struct of_device_id dt_match[] = {
+	{ .compatible = "arm,mali400" },
+	{}
+};
+MODULE_DEVICE_TABLE(of, dt_match);
+
+static struct platform_driver lima_platform_driver = {
+	.probe      = lima_pdev_probe,
+	.remove     = lima_pdev_remove,
+	.driver     = {
+		.name   = "lima",
+		.of_match_table = dt_match,
+	},
+};
+
+static int __init lima_init(void)
+{
+	int ret;
+
+	ret = platform_driver_register(&lima_platform_driver);
+
+	return ret;
+}
+module_init(lima_init);
+
+static void __exit lima_exit(void)
+{
+	platform_driver_unregister(&lima_platform_driver);
+}
+module_exit(lima_exit);
+
+MODULE_AUTHOR("Qiang Yu <yuq825@gmail.com>");
+MODULE_DESCRIPTION("Lima DRM Driver");
+MODULE_LICENSE("GPL v2");
